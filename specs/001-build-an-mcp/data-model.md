# Data Model: Pub.dev Package Intelligence MCP

## Overview
The MCP server exchanges structured payloads for eight tools that mirror pub.dev concepts. All identifiers are case-sensitive and follow pub.dev naming conventions.

## Entities

### PackageSummary
| Field | Type | Source | Notes |
|-------|------|--------|-------|
| `name` | string | pub.dev search | Unique package identifier |
| `description` | string | pub.dev search | 200-character snippet from package description |
| `publisher` | string | pub.dev search | Publisher or `"unknown"` when absent |
| `likes` | integer | pub.dev search | Last known like count |
| `pubPoints` | integer | pub.dev search | Pub points score |
| `popularity` | number (0-1) | pub.dev search | Popularity percentile |
| `latestStable` | `VersionDetail` | pub.dev package detail | Nullable when only prereleases exist |

### SearchResultSet
| Field | Type | Notes |
|-------|------|-------|
| `query` | string | Original keyword string |
| `packages` | array<`PackageSummary`> | Capped at 10 per FR-001 |
| `moreResultsHint` | string | Optional copy instructing follow-up query |

### VersionDetail
| Field | Type | Source | Notes |
|-------|------|--------|-------|
| `version` | string | pub.dev versions list | Semantic version |
| `released` | string (ISO 8601) | pub.dev versions list | Release date |
| `sdkConstraint` | string | pubspec | Flutter/Dart constraint string |
| `isPrerelease` | boolean | pub.dev versions list | Derived from version suffix |
| `releaseNotesUrl` | string | pub.dev package detail | Optional |

### VersionHistory
| Field | Type | Notes |
|-------|------|-------|
| `package` | string | Package identifier |
| `versions` | array<`VersionDetail`> | Ordered newest â†’ oldest |

### CompatibilityRequest
| Field | Type | Notes |
|-------|------|-------|
| `package` | string | Target package name |
| `flutterSdk` | string | Exact version or caret range |
| `projectConstraint` | string? | Optional overriding dependency constraint |

### CompatibilityResult
| Field | Type | Notes |
|-------|------|-------|
| `recommendedVersion` | string? | Null when none satisfies constraint |
| `satisfies` | boolean | Indicates if recommendation meets Flutter SDK constraint |
| `explanation` | string | Text describing rationale |
| `evaluatedVersions` | array<`VersionDetail`> | Versions assessed (limited to latest 20 for performance) |

### DependencyNode
| Field | Type | Notes |
|-------|------|-------|
| `package` | string | Dependency name |
| `requested` | string | Constraint requested by parent |
| `resolved` | string | Version resolved by pub.dev |
| `isDirect` | boolean | True for direct dependencies |
| `children` | array<`DependencyNode`> | Recursive structure |

### DependencyGraph
| Field | Type | Notes |
|-------|------|-------|
| `rootPackage` | string | Package inspected |
| `rootVersion` | string | Version resolved |
| `nodes` | array<`DependencyNode`> | Flattened representation for easy traversal |
| `issues` | array<string> | Constraint conflicts, missing packages, or circular references |

### ScoreInsight
| Field | Type | Notes |
|-------|------|-------|
| `package` | string | Package inspected |
| `overallScore` | number (0-110) | Total score from pub.dev |
| `popularity` | number (0-1) | Popularity component |
| `likes` | integer | Like count |
| `pubPoints` | integer | Pub points |
| `componentNotes` | map<string,string> | Brief explanations for each component |
| `fetchedAt` | string (ISO 8601) | Timestamp of retrieval |

### AuditLogEntry
| Field | Type | Notes |
|-------|------|-------|
| `timestamp` | string (ISO 8601) | Observation time |
| `tool` | string | Name of MCP tool invoked |
| `requestDigest` | string | SHA-256 hash of redacted request |
| `responseDigest` | string | SHA-256 hash of redacted response |
| `status` | string | success, client_error, server_error |

## Relationships
- `SearchResultSet.packages[i].latestStable` references a `VersionDetail` derived from the package detail endpoint.
- `CompatibilityResult.evaluatedVersions` pulls from the `VersionHistory` entity.
- `DependencyGraph.nodes` is generated by traversing the pubspec dependency tree for the chosen version.
- `ScoreInsight` is cached and linked to the `PackageSummary` when returning search results (to enrich metadata when available).
- `AuditLogEntry.tool` enumerates the eight MCP tools, supporting FR-006 observability requirements.

## Validation Rules
- Package names must match `^[a-z0-9_]+$` per pub.dev policy.
- Semantic versions validated with `Semver 2.0.0` parser plus caret support (`^` ranges).
- Flutter SDK version strings must match either exact `major.minor.patch` or caret patterns against the same.
- Search queries trimmed and limited to 80 characters to avoid abuse.
- Dependency graphs limited to depth of 10 to prevent runaway recursion; deeper trees produce a truncation warning in `DependencyGraph.issues`.
